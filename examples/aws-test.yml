name: aws-data

description: Collects EC2 data from one region in one account

configure-aws-accounts:
  runner: json-config
  items:
    - acceptance:
        accessKeyId: ${env.AWS_K}
        secretAccessKey: ${env.AWS_S}
        _meta:
          account: "redapple.acceptance"
          customer: "red apple"

configure-aws-regions:
  runner: json-config
  items:
    - ireland:
        region: eu-west-1

collect-ec2:
  runner: aws-origin.EC2.describeInstances
  transform:
    - jsonpath: $.Reservations..Instances.*
    - reduce: count

push-to-kinesis:
  runner: aws-destination.kinesis.putRecords
