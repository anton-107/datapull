name: generic-data

description: Collects data from Chef API

configure:
  runner: json-config
  items:
    - production:
        username: ${env.USER}
        key_path: ${env.KEY_PATH}
        apiUrl: ${env.URL}

collect:
  runner: chef-origin
  # transform:
  #   - jsonpath: $.results[(@.length-1)]

push-to-kinesis:
  runner: aws-destination.Kinesis.putRecords
  stream: "public-cloud-records"
  region: "eu-west-1"
  partitionKey: "single-shard"
  accessKeyId: ${env.AWS_D_K}
  secretAccessKey: ${env.AWS_D_S}
  extendMessage:
    _meta:
      eventType: "public-cloud-records"
      producedBy: "datapull.v1"
      timestamp: ${pipeline.timestamp}
    details: ${data}
    period: ${pipeline.time.year}${pipeline.time.month}
    quantity: ${rawData.total}
